<!DOCTYPE html>
<html>

<head>
    <title>文章攥写</title>
    <script>
        import React, { } from 'react'
        import MarkdownEdit from 'markdown-editor-reactjs'
        import React, { useState, useRef, useEffect } from 'react'
        import markdownIt from 'markdown-it'
        import './theme/github-theme.css'
        import hljs from 'highlight.js'
        import 'highlight.js/styles/github.css'

        export default function MarkdownEdit() {


            return (
                <div className="markdownEditConainer">
                    <textarea className="edit" />
                    <div className="show" />
                </div>
            )
        }
    </script>
</head>

<body style="background-color:rgb(233, 203, 103) ;">
    <script type="javascript">
        export default function MarkdownEdit() {


            return (
                <div className="markdownEditConainer">
                    <textarea className="edit" />
                    <div className="show" />
                </div>
            )
        }
    </script>
    <!-- <script>
        import MarkdownEdit from 'markdown-editor-reactjs'
        import React, { useState, useRef, useEffect } from 'react'
        import markdownIt from 'markdown-it'
        import './theme/github-theme.css'
        import hljs from 'highlight.js'
        import 'highlight.js/styles/github.css'

        const md = new markdownIt({
            highlight: function (code, language) {
                if (language && hljs.getLanguage(language)) {
                    try {
                        return `<pre><code class="hljs language-${language}">` +
                            hljs.highlight(code, { language }).value +
                            '</code></pre>';
                    } catch (__) { }
                }

                return '<pre class="hljs"><code>' + md.utils.escapeHtml(code) + '</code></pre>';
            }
        })

        let scrolling: 0 | 1 | 2 = 0
        let scrollTimer;

        export default function MarkdownEdit() {
            const [htmlString, setHtmlString] = useState('')
            const [value, setValue] = useState('')   // 编辑区的文字内容
            const edit = useRef(null)
            const show = useRef(null)

            const handleScroll = (block: number, event) => {
                let { scrollHeight, scrollTop, clientHeight } = event.target
                let scale = scrollTop / (scrollHeight - clientHeight)

                if (block === 1) {
                    if (scrolling === 0) scrolling = 1;
                    if (scrolling === 2) return;

                    driveScroll(scale, showRef.current)
                } else if (block === 2) {
                    if (scrolling === 0) scrolling = 2;
                    if (scrolling === 1) return;

                    driveScroll(scale, editRef.current)
                }
            }

            // 驱动一个元素进行滚动
            const driveScroll = (scale: number, el: HTMLElement) => {
                let { scrollHeight, clientHeight } = el
                el.scrollTop = (scrollHeight - clientHeight) * scale

                if (scrollTimer) clearTimeout(scrollTimer);
                scrollTimer = setTimeout(() => {
                    scrolling = 0
                    clearTimeout(scrollTimer)
                }, 200)
            }

            // 加粗工具
            const addBlod = () => {
                // 获取编辑区光标的位置。未选中文字时：selectionStart === selectionEnd ；选中文字时：selectionStart < selectionEnd
                let { selectionStart, selectionEnd } = edit.current
                let newValue = selectionStart === selectionEnd
                    ? value.slice(0, start) + '**加粗文字**' + value.slice(end)
                    : value.slice(0, start) + '**' + value.slice(start, end) + '**' + value.slice(end)
                setValue(newValue)
            }

            useEffect(() => {
                // 编辑区内容改变，更新value的值，并同步渲染
                setHtmlString(md.render(value))
            }, [value])

            return (
                <div className="markdownEditConainer">
                    <button onClick={addBlod}>加粗</button>   {/* 假设一个加粗的按钮 */}
                    <textarea
                        className="edit"
                        ref={edit}
                        onScroll={(e) => handleScroll(1, e)}
                        onChange={(e) => setValue(e.target.value)}   // 直接修改value的值，useEffect会同步渲染展示区的内容
                        value={value}
                    />
                    <div
                        className="show"
                        id="write"
                        ref={show}
                        onScroll={(e) => handleScroll(2, e)}
                        dangerouslySetInnerHTML={{ __html: htmlString }}
                    />
                </div>
            )
        }
        function App() {

            return (
                <App>
                    <MarkdownEdit />
                </App>
            )
        }
    </script> -->


</body>

</html>